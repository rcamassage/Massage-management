<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마사지샵 관리 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            box-sizing: border-box;
        }
        .remaining-time {
            font-size: 2rem;
            font-weight: bold;
            color: #ef4444;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            max-height: 80%;
            overflow-y: auto;
        }
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }
        .selection-item {
            padding: 10px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .selection-item:hover {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .selection-item.selected {
            border-color: #3b82f6;
            background-color: #3b82f6;
            color: white;
        }
        .edit-row {
            background-color: #f3f4f6;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-full">
    <!-- 로그인 화면 -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600">
        <div class="bg-white p-8 rounded-lg shadow-2xl w-full max-w-md">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-2" data-translate="title">마사지샵 관리 시스템</h1>
                <div class="w-20 h-1 bg-blue-500 mx-auto"></div>
            </div>
            
            <!-- 언어 선택 -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">언어 선택 / Language / ภาษา / Ngôn ngữ</label>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="setLanguage('ko')" class="bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600" id="langKo">한국어</button>
                    <button onclick="setLanguage('en')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langEn">English</button>
                    <button onclick="setLanguage('th')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langTh">ไทย</button>
                    <button onclick="setLanguage('vi')" class="bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400" id="langVi">Tiếng Việt</button>
                </div>
            </div>
            
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="username">아이디</label>
                    <input type="text" id="loginUsername" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="usernameInput">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2" data-translate="password">비밀번호</label>
                    <input type="password" id="loginPassword" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" data-translate-placeholder="passwordInput">
                </div>
                <button onclick="processLogin()" class="w-full bg-blue-500 text-white py-2 px-4 rounded-md hover:bg-blue-600 transition duration-200" data-translate="login">로그인</button>
            </div>
        </div>
    </div>



    <!-- 메인 화면 -->
    <div id="mainScreen" class="container mx-auto p-6" style="display: none;">
        <!-- 헤더 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800" data-translate="title">마사지 관리 프로그램</h1>
                    <p id="shopName" class="text-lg text-gray-600 mt-1"></p>
                </div>
                <div class="flex gap-2">
                    <button onclick="showLanguageModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="changeLanguage">언어 변경</button>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" data-translate="logout">로그아웃</button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="text-center">
                    <label class="block text-sm font-medium mb-2" data-translate="todayDate">오늘 날짜</label>
                    <input type="date" id="currentDate" class="border rounded px-3 py-2 w-full" onchange="updateCurrentDate()">
                </div>
                <div class="text-center">
                    <label class="block text-sm font-medium mb-2" data-translate="currentTime">현재 시간</label>
                    <div id="currentTime" class="text-xl font-bold text-blue-600"></div>
                </div>
            </div>
        </div>

        <!-- 메뉴 버튼들 -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
            <button onclick="showDashboard()" class="bg-blue-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-blue-600" data-translate="dashboard">현황판</button>
            <button onclick="showOrder()" class="bg-indigo-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-indigo-600" data-translate="order">순번</button>
            <button onclick="showReservation()" class="bg-green-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-green-600" data-translate="reservation">예약</button>
            <button onclick="showStatistics()" class="bg-purple-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-purple-600" data-translate="statistics">통계</button>
            <button onclick="showDBManagement()" class="bg-orange-500 text-white py-4 px-6 rounded-lg text-lg hover:bg-orange-600" data-translate="dbManagement">DB 관리</button>
        </div>

        <!-- 순번 섹션 -->
        <div id="orderSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="orderManagement">순번 관리</h2>
            <div class="mb-4">
                <button onclick="saveStaffOrder()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="saveOrder">순번 저장</button>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2" data-translate="staffName">직원명</th>
                            <th class="border border-gray-300 p-2" data-translate="status">상태</th>
                            <th class="border border-gray-300 p-2" data-translate="orderNumber">순번</th>
                        </tr>
                    </thead>
                    <tbody id="orderTable">
                    </tbody>
                </table>
            </div>
            <div class="mt-4 text-sm text-gray-600">
                * 순번 0은 휴가로 처리됩니다.
            </div>
        </div>

        <!-- 현황판 -->
        <div id="dashboardSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="dashboard">현황판</h2>
            <div class="overflow-x-auto">
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2" data-translate="staff">직원명</th>
                            <th class="border border-gray-300 p-2" data-translate="menu">메뉴</th>
                            <th class="border border-gray-300 p-2" data-translate="duration">시간</th>
                            <th class="border border-gray-300 p-2" data-translate="startTime">시작시간</th>
                            <th class="border border-gray-300 p-2" data-translate="endTime">끝시간</th>
                            <th class="border border-gray-300 p-2" data-translate="remainingTime">남은시간</th>
                            <th class="border border-gray-300 p-2" data-translate="price">가격</th>
                            <th class="border border-gray-300 p-2" data-translate="commission">커미션</th>
                            <th class="border border-gray-300 p-2" data-translate="roomNumber">방번호</th>
                            <th class="border border-gray-300 p-2" data-translate="actions">작업</th>
                        </tr>
                    </thead>
                    <tbody id="dashboardTable">
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 예약 섹션 -->
        <div id="reservationSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="reservation">예약</h2>
            
            <!-- 마사지사 선택 -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2" data-translate="selectStaff">마사지사 선택</label>
                <div id="staffSelection" class="selection-grid"></div>
            </div>

            <!-- 메뉴 선택 -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2" data-translate="selectMenu">메뉴 선택</label>
                <div id="menuSelection" class="selection-grid"></div>
            </div>

            <!-- 시간 선택 -->
            <div class="mb-6">
                <label class="block text-sm font-medium mb-2" data-translate="duration">시간 선택</label>
                <div id="durationSelection" class="selection-grid"></div>
            </div>

            <!-- 추가 옵션들 -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium mb-2" data-translate="startTime">시작 시간 (선택사항)</label>
                    <input type="time" id="reservationStartTime" class="w-full border rounded px-3 py-2">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2" data-translate="roomNumber">방번호 (선택사항)</label>
                    <select id="reservationRoom" class="w-full border rounded px-3 py-2">
                        <option value="">방 선택</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2" data-translate="customerName">고객명 (선택사항)</label>
                    <input type="text" id="reservationCustomer" class="w-full border rounded px-3 py-2" placeholder="고객명 입력">
                </div>
            </div>

            <!-- 가격 정보 -->
            <div class="mb-4 p-4 bg-gray-100 rounded">
                <div class="grid grid-cols-2 gap-4">
                    <div><strong data-translate="price">가격:</strong> <span id="reservationPrice">0</span><span id="reservationPriceCurrency"></span></div>
                    <div><strong data-translate="commission">커미션:</strong> <span id="reservationCommission">0</span><span id="reservationCommissionCurrency"></span></div>
                </div>
            </div>

            <button onclick="addReservation()" class="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600" data-translate="addReservation">예약 추가</button>
        </div>

        <!-- 통계 섹션 -->
        <div id="statisticsSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="statistics">통계</h2>
            <div class="mb-4 flex gap-4 flex-wrap">
                <button onclick="showDailyStats()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" data-translate="daily">일간</button>
                <button onclick="showWeeklyStats()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="weekly">주간</button>
                <button onclick="showMonthlyStats()" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600" data-translate="monthly">월간</button>
                <button onclick="showMenuChart()" class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600">메뉴 그래프</button>
                <button onclick="showMonthlyChart()" class="bg-pink-500 text-white px-4 py-2 rounded hover:bg-pink-600">월간 그래프</button>
                <button onclick="downloadExcel()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">다운로드</button>
            </div>
            <div class="mb-4">
                <input type="date" id="statsDate" class="border rounded px-3 py-2" onchange="updateStats()">
            </div>
            
            <!-- 차트 영역 -->
            <div id="chartContainer" class="mb-6" style="display: none;">
                <canvas id="statsChart" width="800" height="400"></canvas>
            </div>
            
            <!-- 직원별 통계 -->
            <div class="mb-6">
                <h3 class="text-lg font-bold mb-2">직원별 통계</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2" data-translate="staff">마사지사</th>
                                <th class="border border-gray-300 p-2" data-translate="totalPrice">총 가격</th>
                                <th class="border border-gray-300 p-2" data-translate="totalCommission">총 커미션</th>
                            </tr>
                        </thead>
                        <tbody id="statsTable">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 입금방식별 통계 -->
            <div class="mb-6">
                <h3 class="text-lg font-bold mb-2">입금방식별 통계</h3>
                <div class="overflow-x-auto">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                <th class="border border-gray-300 p-2">입금방식</th>
                                <th class="border border-gray-300 p-2">금액</th>
                            </tr>
                        </thead>
                        <tbody id="paymentStatsTable">
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="p-4 bg-gray-100 rounded">
                <div class="grid grid-cols-3 gap-4">
                    <div><strong data-translate="grandTotal">총 금액(QR팁 제외):</strong> <span id="grandTotalPrice">0</span><span id="grandTotalCurrency"></span></div>
                    <div><strong data-translate="grandTotalCommission">총 커미션:</strong> <span id="grandTotalCommission">0</span><span id="grandTotalCommissionCurrency"></span></div>
                    <div><strong data-translate="profit">수익:</strong> <span id="totalProfit">0</span><span id="totalProfitCurrency"></span></div>
                </div>
            </div>
        </div>

        <!-- DB 관리 섹션 -->
        <div id="dbManagementSection" class="bg-white rounded-lg shadow-md p-6" style="display: none;">
            <h2 class="text-2xl font-bold mb-4" data-translate="dbManagement">DB 관리</h2>
            
            <!-- 데이터 백업/복원 -->
            <div class="mb-6 p-4 bg-gray-100 rounded">
                <h3 class="text-lg font-bold mb-2">데이터 백업 및 복원</h3>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <h4 class="font-semibold mb-2">백업</h4>
                        <div class="flex gap-2 flex-wrap">
                            <button onclick="showLocalBackupDialog()" class="bg-green-600 text-white px-3 py-2 rounded hover:bg-green-700 text-sm">로컬 백업</button>
                            <button onclick="showGoogleBackupDialog()" class="bg-blue-600 text-white px-3 py-2 rounded hover:bg-blue-700 text-sm">구글 백업</button>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold mb-2">복원</h4>
                        <div class="flex gap-2 flex-wrap">
                            <input type="file" id="restoreFile" accept=".json" style="display: none;" onchange="restoreData(event)">
                            <button onclick="showLocalRestoreDialog()" class="bg-orange-600 text-white px-3 py-2 rounded hover:bg-orange-700 text-sm">로컬 복원</button>
                            <button onclick="showGoogleRestoreDialog()" class="bg-indigo-600 text-white px-3 py-2 rounded hover:bg-indigo-700 text-sm">구글 복원</button>
                        </div>
                    </div>
                </div>
                <div class="mt-4">
                    <button onclick="exportAllDataExcel()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">전체 데이터 엑셀 내보내기</button>
                </div>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <button onclick="manageMenus()" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600" data-translate="menuManagement">메뉴 관리</button>
                <button onclick="manageStaff()" class="bg-green-500 text-white py-3 px-4 rounded hover:bg-green-600" data-translate="staffManagement">직원 관리</button>
                <button onclick="manageRooms()" class="bg-purple-500 text-white py-3 px-4 rounded hover:bg-purple-600" data-translate="roomManagement">방 관리</button>
                <button onclick="manageCustomers()" class="bg-orange-500 text-white py-3 px-4 rounded hover:bg-orange-600" data-translate="customerManagement">고객 관리</button>
                <button onclick="manageCurrency()" class="bg-pink-500 text-white py-3 px-4 rounded hover:bg-pink-600" data-translate="currencyManagement">화폐 단위</button>
                <button onclick="managePaymentMethods()" class="bg-yellow-500 text-white py-3 px-4 rounded hover:bg-yellow-600" data-translate="paymentMethodManagement">입금방식 관리</button>
                <div id="superAdminButtons" style="display: none;">
                    <button onclick="manageAdmins()" class="bg-red-500 text-white py-3 px-4 rounded hover:bg-red-600" data-translate="adminManagement">관리자 관리</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 입금 모달 -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4" data-translate="payment">입금 처리</h3>
            <div id="paymentMethods" class="space-y-4 mb-4">
            </div>
            <div class="mb-4">
                <strong data-translate="totalAmount">총 금액:</strong> <span id="paymentTotalAmount">0</span><span id="paymentCurrency"></span>
            </div>
            <div class="mb-4">
                <strong data-translate="enteredAmount">입력된 금액:</strong> <span id="paymentEnteredAmount">0</span><span id="paymentEnteredCurrency"></span>
            </div>
            <div class="flex gap-2">
                <button onclick="processPayment()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="confirm">확인</button>
                <button onclick="closePaymentModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="cancel">취소</button>
            </div>
        </div>
    </div>

    <!-- 범용 관리 모달 -->
    <div id="managementModal" class="modal">
        <div class="modal-content">
            <h3 id="managementTitle" class="text-xl font-bold mb-4"></h3>
            <div id="managementContent"></div>
            <button onclick="closeManagementModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600" data-translate="close">닫기</button>
        </div>
    </div>

    <!-- 언어 변경 모달 -->
    <div id="languageModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">언어 선택 / Language / ภาษา / Ngôn ngữ</h3>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="setLanguageAndClose('ko')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">한국어</button>
                <button onclick="setLanguageAndClose('en')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">English</button>
                <button onclick="setLanguageAndClose('th')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">ไทย</button>
                <button onclick="setLanguageAndClose('vi')" class="bg-blue-500 text-white py-3 px-4 rounded hover:bg-blue-600">Tiếng Việt</button>
            </div>
            <button onclick="closeLanguageModal()" class="mt-4 bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">닫기</button>
        </div>
    </div>

    <!-- 구글 로그인 모달 -->
    <div id="googleLoginModal" class="modal">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">구글 계정 로그인</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2">구글 이메일:</label>
                    <input type="email" id="googleEmail" class="w-full border rounded px-3 py-2" placeholder="example@gmail.com">
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">구글 비밀번호:</label>
                    <input type="password" id="googlePassword" class="w-full border rounded px-3 py-2" placeholder="비밀번호 입력">
                </div>
                <div class="text-sm text-gray-600">
                    * 실제 구글 계정 정보를 입력하세요. 백업/복원을 위해 구글 드라이브에 접근합니다.
                </div>
            </div>
            <div class="flex gap-2 mt-4">
                <button id="googleLoginConfirm" onclick="processGoogleLogin()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">로그인</button>
                <button onclick="closeGoogleLoginModal()" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">취소</button>
            </div>
        </div>
    </div>

    <script>
        // 전역 변수
        let currentLanguage = 'ko';
        let currentAdmin = null;
        let currentPaymentReservationId = null;
        let selectedStaff = null;
        let selectedMenu = null;
        let selectedDuration = null;

        // 번역 데이터
        const translations = {
            ko: {
                title: '마사지 관리 프로그램',
                changeLanguage: '언어 변경',
                logout: '로그아웃',
                todayDate: '오늘 날짜',
                currentTime: '현재 시간',
                dashboard: '현황판',
                order: '순번',
                reservation: '예약',
                statistics: '통계',
                dbManagement: 'DB 관리',
                staff: '직원명',
                menu: '메뉴',
                duration: '시간',
                startTime: '시작시간',
                endTime: '끝시간',
                remainingTime: '남은시간',
                price: '가격',
                commission: '커미션',
                roomNumber: '방번호',
                actions: '작업',
                selectStaff: '마사지사 선택',
                selectMenu: '메뉴 선택',
                customerName: '고객명',
                addReservation: '예약 추가',
                daily: '일간',
                weekly: '주간',
                monthly: '월간',
                totalPrice: '총 가격',
                totalCommission: '총 커미션',
                grandTotal: '총 금액(QR팁 제외)',
                grandTotalCommission: '총 커미션',
                profit: '수익',
                menuManagement: '메뉴 관리',
                staffManagement: '직원 관리',
                roomManagement: '방 관리',
                customerManagement: '고객 관리',
                adminManagement: '관리자 관리',
                currencyManagement: '화폐 단위',
                paymentMethodManagement: '입금방식 관리',
                payment: '입금 처리',
                totalAmount: '총 금액',
                enteredAmount: '입력된 금액',
                confirm: '확인',
                cancel: '취소',
                login: '로그인',
                close: '닫기',
                edit: '수정',
                delete: '삭제',
                add: '추가',
                save: '저장',
                username: '아이디',
                password: '비밀번호',
                usernameInput: '아이디를 입력하세요',
                passwordInput: '비밀번호를 입력하세요',
                staffName: '직원명',
                phoneNumber: '전화번호',
                bankName: '은행명',
                accountNumber: '계좌번호',
                status: '상태',
                roomNum: '방번호',
                customerNum: '고객번호',
                paymentMethodName: '입금방식명',
                shopName: '가게명',
                adminType: '타입',
                orderManagement: '순번 관리',
                saveOrder: '순번 저장',
                orderNumber: '순번'
            },
            vi: {
                title: 'Hệ thống quản lý massage',
                changeLanguage: 'Đổi ngôn ngữ',
                logout: 'Đăng xuất',
                todayDate: 'Ngày hôm nay',
                currentTime: 'Thời gian hiện tại',
                dashboard: 'Bảng điều khiển',
                order: 'Thứ tự',
                reservation: 'Đặt chỗ',
                statistics: 'Thống kê',
                dbManagement: 'Quản lý DB',
                staff: 'Nhân viên',
                menu: 'Menu',
                duration: 'Thời gian',
                startTime: 'Thời gian bắt đầu',
                endTime: 'Thời gian kết thúc',
                remainingTime: 'Thời gian còn lại',
                price: 'Giá',
                commission: 'Hoa hồng',
                roomNumber: 'Số phòng',
                actions: 'Hành động',
                selectStaff: 'Chọn nhân viên',
                selectMenu: 'Chọn menu',
                customerName: 'Tên khách hàng',
                addReservation: 'Thêm đặt chỗ',
                daily: 'Hàng ngày',
                weekly: 'Hàng tuần',
                monthly: 'Hàng tháng',
                totalPrice: 'Tổng giá',
                totalCommission: 'Tổng hoa hồng',
                grandTotal: 'Tổng cộng (trừ QR tip)',
                grandTotalCommission: 'Tổng hoa hồng',
                profit: 'Lợi nhuận',
                menuManagement: 'Quản lý menu',
                staffManagement: 'Quản lý nhân viên',
                roomManagement: 'Quản lý phòng',
                customerManagement: 'Quản lý khách hàng',
                adminManagement: 'Quản lý admin',
                currencyManagement: 'Đơn vị tiền tệ',
                paymentMethodManagement: 'Quản lý phương thức thanh toán',
                payment: 'Thanh toán',
                totalAmount: 'Tổng số tiền',
                enteredAmount: 'Số tiền đã nhập',
                confirm: 'Xác nhận',
                cancel: 'Hủy',
                login: 'Đăng nhập',
                close: 'Đóng',
                edit: 'Sửa',
                delete: 'Xóa',
                add: 'Thêm',
                save: 'Lưu',
                username: 'Tên đăng nhập',
                password: 'Mật khẩu',
                usernameInput: 'Nhập tên đăng nhập',
                passwordInput: 'Nhập mật khẩu',
                staffName: 'Tên nhân viên',
                phoneNumber: 'Số điện thoại',
                bankName: 'Tên ngân hàng',
                accountNumber: 'Số tài khoản',
                status: 'Trạng thái',
                roomNum: 'Số phòng',
                customerNum: 'Số khách hàng',
                paymentMethodName: 'Tên phương thức thanh toán',
                shopName: 'Tên cửa hàng',
                adminType: 'Loại',
                orderManagement: 'Quản lý thứ tự',
                saveOrder: 'Lưu thứ tự',
                orderNumber: 'Thứ tự'
            },
            en: {
                title: 'Massage Management System',
                changeLanguage: 'Change Language',
                logout: 'Logout',
                todayDate: 'Today\'s Date',
                currentTime: 'Current Time',
                dashboard: 'Dashboard',
                order: 'Order',
                reservation: 'Reservation',
                statistics: 'Statistics',
                dbManagement: 'DB Management',
                staff: 'Staff',
                menu: 'Menu',
                duration: 'Duration',
                startTime: 'Start Time',
                endTime: 'End Time',
                remainingTime: 'Remaining Time',
                price: 'Price',
                commission: 'Commission',
                roomNumber: 'Room Number',
                actions: 'Actions',
                selectStaff: 'Select Staff',
                selectMenu: 'Select Menu',
                customerName: 'Customer Name',
                addReservation: 'Add Reservation',
                daily: 'Daily',
                weekly: 'Weekly',
                monthly: 'Monthly',
                totalPrice: 'Total Price',
                totalCommission: 'Total Commission',
                grandTotal: 'Grand Total (excl. QR tip)',
                grandTotalCommission: 'Grand Total Commission',
                profit: 'Profit',
                menuManagement: 'Menu Management',
                staffManagement: 'Staff Management',
                roomManagement: 'Room Management',
                customerManagement: 'Customer Management',
                adminManagement: 'Admin Management',
                currencyManagement: 'Currency Unit',
                paymentMethodManagement: 'Payment Method Management',
                payment: 'Payment Processing',
                totalAmount: 'Total Amount',
                enteredAmount: 'Entered Amount',
                confirm: 'Confirm',
                cancel: 'Cancel',
                login: 'Login',
                close: 'Close',
                edit: 'Edit',
                delete: 'Delete',
                add: 'Add',
                save: 'Save',
                username: 'Username',
                password: 'Password',
                usernameInput: 'Enter username',
                passwordInput: 'Enter password',
                staffName: 'Staff Name',
                phoneNumber: 'Phone Number',
                bankName: 'Bank Name',
                accountNumber: 'Account Number',
                status: 'Status',
                roomNum: 'Room Number',
                customerNum: 'Customer Number',
                paymentMethodName: 'Payment Method Name',
                shopName: 'Shop Name',
                adminType: 'Type',
                orderManagement: 'Order Management',
                saveOrder: 'Save Order',
                orderNumber: 'Order'
            },
            th: {
                title: 'ระบบจัดการนวดแผนไทย',
                changeLanguage: 'เปลี่ยนภาษา',
                logout: 'ออกจากระบบ',
                todayDate: 'วันที่วันนี้',
                currentTime: 'เวลาปัจจุบัน',
                dashboard: 'แดชบอร์ด',
                order: 'ลำดับ',
                reservation: 'การจอง',
                statistics: 'สถิติ',
                dbManagement: 'จัดการฐานข้อมูล',
                staff: 'พนักงาน',
                menu: 'เมนู',
                duration: 'ระยะเวลา',
                startTime: 'เวลาเริ่ม',
                endTime: 'เวลาสิ้นสุด',
                remainingTime: 'เวลาที่เหลือ',
                price: 'ราคา',
                commission: 'คอมมิชชั่น',
                roomNumber: 'หมายเลขห้อง',
                actions: 'การดำเนินการ',
                selectStaff: 'เลือกพนักงาน',
                selectMenu: 'เลือกเมนู',
                customerName: 'ชื่อลูกค้า',
                addReservation: 'เพิ่มการจอง',
                daily: 'รายวัน',
                weekly: 'รายสัปดาห์',
                monthly: 'รายเดือน',
                totalPrice: 'ราคารวม',
                totalCommission: 'คอมมิชชั่นรวม',
                grandTotal: 'ยอดรวมทั้งหมด (ไม่รวม QR tip)',
                grandTotalCommission: 'คอมมิชชั่นรวมทั้งหมด',
                profit: 'กำไร',
                menuManagement: 'จัดการเมนู',
                staffManagement: 'จัดการพนักงาน',
                roomManagement: 'จัดการห้อง',
                customerManagement: 'จัดการลูกค้า',
                adminManagement: 'จัดการผู้ดูแล',
                currencyManagement: 'หน่วยเงินตรา',
                paymentMethodManagement: 'จัดการวิธีการชำระเงิน',
                payment: 'การชำระเงิน',
                totalAmount: 'จำนวนเงินรวม',
                enteredAmount: 'จำนวนเงินที่ป้อน',
                confirm: 'ยืนยัน',
                cancel: 'ยกเลิก',
                login: 'เข้าสู่ระบบ',
                close: 'ปิด',
                edit: 'แก้ไข',
                delete: 'ลบ',
                add: 'เพิ่ม',
                save: 'บันทึก',
                username: 'ชื่อผู้ใช้',
                password: 'รหัสผ่าน',
                usernameInput: 'กรอกชื่อผู้ใช้',
                passwordInput: 'กรอกรหัสผ่าน',
                staffName: 'ชื่อพนักงาน',
                phoneNumber: 'หมายเลขโทรศัพท์',
                bankName: 'ชื่อธนาคาร',
                accountNumber: 'หมายเลขบัญชี',
                status: 'สถานะ',
                roomNum: 'หมายเลขห้อง',
                customerNum: 'หมายเลขลูกค้า',
                paymentMethodName: 'ชื่อวิธีการชำระเงิน',
                shopName: 'ชื่อร้าน',
                adminType: 'ประเภท',
                orderManagement: 'จัดการลำดับ',
                saveOrder: 'บันทึกลำดับ',
                orderNumber: 'ลำดับ'
            }
        };

        // 초기화
        function initializeApp() {
            initializeGlobalData();
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            document.getElementById('currentDate').value = new Date().toISOString().split('T')[0];
        }

        // 전역 데이터 초기화 (관리자 계정만)
        function initializeGlobalData() {
            if (!localStorage.getItem('globalAdmins')) {
                localStorage.setItem('globalAdmins', JSON.stringify([
                    {id: 1, username: 'admin', password: '12345678', type: 'super', shopName: '', phone: ''},
                    {id: 2, username: 'shop1', password: '12345678', type: 'normal', shopName: '힐링 마사지', phone: '02-1234-5678'},
                    {id: 3, username: 'Test', password: '1111', type: 'normal', shopName: '테스트 마사지', phone: '02-0000-0000'}
                ]));
            }

            if (!localStorage.getItem('globalCurrency')) {
                localStorage.setItem('globalCurrency', JSON.stringify({
                    symbol: '',
                    name: '원'
                }));
            }
        }

        // 관리자별 데이터베이스 키 생성
        function getAdminKey(dataType) {
            return `${currentAdmin.username}_${dataType}`;
        }

        // 관리자별 데이터 초기화
        function initializeAdminData() {
            const adminPrefix = currentAdmin.username;

            // 기본 데이터 설정
            if (!localStorage.getItem(getAdminKey('menus'))) {
                localStorage.setItem(getAdminKey('menus'), JSON.stringify([
                    {
                        id: 1, 
                        name: '타이 마사지',
                        prices: {
                            30: {price: 30000, commission: 15000},
                            60: {price: 50000, commission: 25000},
                            90: {price: 70000, commission: 35000},
                            120: {price: 90000, commission: 45000}
                        }
                    },
                    {
                        id: 2, 
                        name: '오일 마사지',
                        prices: {
                            60: {price: 80000, commission: 40000},
                            90: {price: 110000, commission: 55000},
                            120: {price: 140000, commission: 70000}
                        }
                    }
                ]));
            }

            if (!localStorage.getItem(getAdminKey('staff'))) {
                localStorage.setItem(getAdminKey('staff'), JSON.stringify([
                    {id: 1, name: '김미영', phone: '010-1234-5678', bank: '국민은행', account: '123-456-789', status: '정직원'},
                    {id: 2, name: '이수진', phone: '010-9876-5432', bank: '신한은행', account: '987-654-321', status: '정직원'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('staffOrder'))) {
                localStorage.setItem(getAdminKey('staffOrder'), JSON.stringify({}));
            }

            if (!localStorage.getItem(getAdminKey('rooms'))) {
                localStorage.setItem(getAdminKey('rooms'), JSON.stringify([
                    {id: 1, roomNumber: '101', capacity: 1},
                    {id: 2, roomNumber: '102', capacity: 2},
                    {id: 3, roomNumber: '103', capacity: 1}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('customers'))) {
                localStorage.setItem(getAdminKey('customers'), JSON.stringify([
                    {id: 1, name: '홍길동', phone: '010-1111-2222', customerNumber: '100001'},
                    {id: 2, name: '김철수', phone: '010-3333-4444', customerNumber: '100002'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('paymentMethods'))) {
                localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify([
                    {id: 1, name: '현금'},
                    {id: 2, name: 'QR'},
                    {id: 3, name: '쿠폰'},
                    {id: 4, name: 'QR팁'},
                    {id: 5, name: '기타'}
                ]));
            }

            if (!localStorage.getItem(getAdminKey('reservations'))) {
                localStorage.setItem(getAdminKey('reservations'), JSON.stringify([]));
            }

            if (!localStorage.getItem(getAdminKey('currency'))) {
                const globalCurrency = JSON.parse(localStorage.getItem('globalCurrency'));
                localStorage.setItem(getAdminKey('currency'), JSON.stringify(globalCurrency));
            }
        }

        // 로그인 처리
        function processLogin() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            if (!username || !password) {
                alert('아이디와 비밀번호를 입력해주세요.');
                return;
            }

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.username === username && a.password === password);
            
            if (admin) {
                currentAdmin = admin;
                initializeAdminData();
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('mainScreen').style.display = 'block';
                
                // 상점명 설정
                const shopNameElement = document.getElementById('shopName');
                if (admin.type === 'super') {
                    shopNameElement.textContent = '최고 관리자 화면';
                    document.getElementById('superAdminButtons').style.display = 'block';
                } else {
                    shopNameElement.textContent = admin.shopName;
                    document.getElementById('superAdminButtons').style.display = 'none';
                }
                
                loadReservationData();
                showDashboard();
            } else {
                alert('아이디 또는 비밀번호가 잘못되었습니다.');
            }
        }

        // 로그아웃
        function logout() {
            if (confirm('로그아웃 하시겠습니까?')) {
                currentAdmin = null;
                selectedStaff = null;
                selectedMenu = null;
                selectedDuration = null;
                document.getElementById('mainScreen').style.display = 'none';
                document.getElementById('loginScreen').style.display = 'flex';
                document.getElementById('loginUsername').value = '';
                document.getElementById('loginPassword').value = '';
                
                // 모든 섹션 숨기기
                hideAllSections();
                
                // 언어를 한국어로 초기화
                setLanguage('ko');
            }
        }

        // 언어 설정
        function setLanguage(lang) {
            currentLanguage = lang;
            
            // 언어 버튼 스타일 업데이트
            document.getElementById('langKo').className = lang === 'ko' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langEn').className = lang === 'en' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langTh').className = lang === 'th' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            document.getElementById('langVi').className = lang === 'vi' ? 'bg-blue-500 text-white py-2 px-3 rounded text-sm hover:bg-blue-600' : 'bg-gray-300 text-gray-700 py-2 px-3 rounded text-sm hover:bg-gray-400';
            
            updateTranslations();
            
            // 메인 화면이 표시된 경우에만 데이터 로드
            if (document.getElementById('mainScreen').style.display === 'block') {
                loadReservationData();
                showDashboard();
            }
        }

        function updateTranslations() {
            const elements = document.querySelectorAll('[data-translate]');
            elements.forEach(element => {
                const key = element.getAttribute('data-translate');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    if (element.tagName === 'INPUT' && (element.type === 'text' || element.type === 'password')) {
                        element.placeholder = translations[currentLanguage][key];
                    } else {
                        element.textContent = translations[currentLanguage][key];
                    }
                }
            });
            
            // placeholder 전용 번역 처리
            const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-translate-placeholder');
                if (translations[currentLanguage] && translations[currentLanguage][key]) {
                    element.placeholder = translations[currentLanguage][key];
                }
            });
            
            updateCurrencyDisplay();
        }

        // 화폐 단위 표시 업데이트
        function updateCurrencyDisplay() {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const currencyElements = document.querySelectorAll('[id$="Currency"]');
            currencyElements.forEach(element => {
                element.textContent = currency.symbol;
            });
        }

        // 시간 업데이트
        function updateCurrentTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString();
            updateDashboardRemainingTime();
        }

        function updateCurrentDate() {
            loadReservationData();
        }

        // 섹션 표시/숨김
        function hideAllSections() {
            const sections = ['dashboardSection', 'orderSection', 'reservationSection', 'statisticsSection', 'dbManagementSection'];
            sections.forEach(section => {
                document.getElementById(section).style.display = 'none';
            });
        }

        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboardSection').style.display = 'block';
            loadDashboard();
        }

        function showReservation() {
            hideAllSections();
            document.getElementById('reservationSection').style.display = 'block';
            loadReservationData();
        }

        function showStatistics() {
            hideAllSections();
            document.getElementById('statisticsSection').style.display = 'block';
            document.getElementById('statsDate').value = document.getElementById('currentDate').value;
            showDailyStats();
        }

        function showOrder() {
            hideAllSections();
            document.getElementById('orderSection').style.display = 'block';
            loadStaffOrder();
        }

        function showDBManagement() {
            hideAllSections();
            document.getElementById('dbManagementSection').style.display = 'block';
        }

        // 현황판 관련 함수
        function loadDashboard() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
            const currentDate = document.getElementById('currentDate').value;
            const todayReservations = reservations.filter(r => r.date === currentDate);
            
            // 순번 순서로 정렬
            todayReservations.sort((a, b) => {
                const orderA = staffOrder[a.staffId] || 999;
                const orderB = staffOrder[b.staffId] || 999;
                return orderA - orderB;
            });
            
            const tableBody = document.getElementById('dashboardTable');
            tableBody.innerHTML = '';

            todayReservations.forEach(reservation => {
                const row = document.createElement('tr');
                const endTime = calculateEndTime(reservation.startTime, reservation.duration);
                const remainingMinutes = calculateRemainingTime(reservation.startTime, reservation.duration);
                
                if (reservation.paid) {
                    row.className = 'bg-green-50';
                }
                
                const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
                
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${reservation.staffName}</td>
                    <td class="border border-gray-300 p-2">${reservation.menuName}</td>
                    <td class="border border-gray-300 p-2">${reservation.duration}분</td>
                    <td class="border border-gray-300 p-2">${reservation.startTime || '-'}</td>
                    <td class="border border-gray-300 p-2">${reservation.startTime ? endTime : '-'}</td>
                    <td class="border border-gray-300 p-2 remaining-time">${reservation.paid ? '완료' : (reservation.startTime ? remainingMinutes + '분' : '-')}</td>
                    <td class="border border-gray-300 p-2">${reservation.price.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${reservation.commission.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${reservation.roomNumber || '-'}</td>
                    <td class="border border-gray-300 p-2">
                        ${reservation.paid ? 
                            '<span class="bg-green-500 text-white px-3 py-1 rounded text-sm font-bold">입금 완료</span>' :
                            `<button onclick="editReservation(${reservation.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                             <button onclick="showPaymentModal(${reservation.id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">입금</button>
                             <button onclick="deleteReservation(${reservation.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>`
                        }
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function calculateEndTime(startTime, duration) {
            if (!startTime) return '-';
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + duration;
            const endHours = Math.floor(endMinutes / 60);
            const endMins = endMinutes % 60;
            return `${endHours.toString().padStart(2, '0')}:${endMins.toString().padStart(2, '0')}`;
        }

        function calculateRemainingTime(startTime, duration) {
            if (!startTime) return 0;
            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            
            const [hours, minutes] = startTime.split(':').map(Number);
            const startMinutes = hours * 60 + minutes;
            const endMinutes = startMinutes + duration;
            
            return Math.max(0, endMinutes - currentMinutes);
        }

        function updateDashboardRemainingTime() {
            const remainingCells = document.querySelectorAll('.remaining-time');
            remainingCells.forEach((cell, index) => {
                const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
                const currentDate = document.getElementById('currentDate').value;
                const todayReservations = reservations.filter(r => r.date === currentDate);
                
                if (todayReservations[index]) {
                    const reservation = todayReservations[index];
                    
                    if (reservation.paid) {
                        cell.textContent = '완료';
                        cell.style.color = '#10b981';
                        cell.style.fontWeight = 'bold';
                    } else if (reservation.startTime) {
                        const remaining = calculateRemainingTime(reservation.startTime, reservation.duration);
                        cell.textContent = `${remaining}분`;
                        
                        if (remaining <= 10) {
                            cell.style.color = '#ef4444';
                        } else if (remaining <= 30) {
                            cell.style.color = '#f59e0b';
                        } else {
                            cell.style.color = '#10b981';
                        }
                    } else {
                        cell.textContent = '-';
                        cell.style.color = '#6b7280';
                    }
                }
            });
        }

        // 예약 관련 함수
        function loadReservationData() {
            loadStaffSelection();
            loadMenuSelection();
            loadRoomSelection();
            updateReservationDetails();
        }

        function loadStaffSelection() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const currentDate = document.getElementById('currentDate').value;
            
            // 퇴사자 제외하고 정직원과 단기고용만 표시 (상태가 없는 경우 정직원으로 간주)
            const activeStaff = staff.filter(s => {
                const status = s.status || '정직원';
                return status !== '퇴사';
            });
            
            // 순번으로 정렬 (순번이 없는 경우 999로 처리하여 맨 뒤로)
            activeStaff.sort((a, b) => {
                const orderA = staffOrder[a.id] || 999;
                const orderB = staffOrder[b.id] || 999;
                return orderA - orderB;
            });
            
            const container = document.getElementById('staffSelection');
            container.innerHTML = '';

            activeStaff.forEach(s => {
                const order = staffOrder[s.id] || 1;
                const isOnVacation = order === 0;
                const hasReservation = reservations.some(r => 
                    r.date === currentDate && 
                    r.staffId === s.id && 
                    !r.paid && 
                    r.startTime
                );
                
                const div = document.createElement('div');
                div.className = 'selection-item';
                div.setAttribute('data-staff-id', s.id);
                
                // 상태에 따른 색상 설정
                if (hasReservation) {
                    div.style.backgroundColor = '#9ca3af'; // 회색 - 예약 진행 중
                    div.style.color = 'white';
                    div.style.cursor = 'not-allowed';
                } else if (isOnVacation) {
                    div.style.backgroundColor = '#ef4444'; // 빨간색 - 휴가
                    div.style.color = 'white';
                    div.style.cursor = 'not-allowed';
                } else {
                    div.style.backgroundColor = '#3b82f6'; // 파란색 - 선택 가능
                    div.style.color = 'white';
                }
                
                div.textContent = `${s.name} (${order === 0 ? '휴가' : order})`;
                
                if (!hasReservation && !isOnVacation) {
                    div.onclick = () => selectStaff(s.id, s.name, div);
                }
                
                container.appendChild(div);
            });
        }

        function loadMenuSelection() {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const container = document.getElementById('menuSelection');
            container.innerHTML = '';

            menus.forEach(m => {
                const div = document.createElement('div');
                div.className = 'selection-item';
                div.textContent = m.name;
                div.onclick = () => selectMenu(m.id, m.name, div);
                container.appendChild(div);
            });
        }

        function loadDurationSelection() {
            if (!selectedMenu) return;
            
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === selectedMenu.id);
            const container = document.getElementById('durationSelection');
            container.innerHTML = '';

            if (menu && menu.prices) {
                Object.keys(menu.prices).forEach(duration => {
                    const div = document.createElement('div');
                    div.className = 'selection-item';
                    div.textContent = `${duration}분`;
                    div.onclick = () => selectDuration(parseInt(duration), div);
                    container.appendChild(div);
                });
            }
        }

        function loadRoomSelection() {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const roomSelect = document.getElementById('reservationRoom');
            roomSelect.innerHTML = '<option value="">방 선택</option>';
            rooms.forEach(r => {
                roomSelect.innerHTML += `<option value="${r.id}">${r.roomNumber}</option>`;
            });
        }

        function selectStaff(id, name, element) {
            // 이전 선택 해제
            document.querySelectorAll('#staffSelection .selection-item').forEach(item => {
                item.classList.remove('selected');
                // 원래 색상으로 복원
                const staffId = item.getAttribute('data-staff-id');
                if (staffId) {
                    const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
                    const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
                    const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
                    const currentDate = document.getElementById('currentDate').value;
                    
                    const staffMember = staff.find(s => s.id == staffId);
                    if (staffMember) {
                        const order = staffOrder[staffMember.id] || 1;
                        const isOnVacation = order === 0;
                        const hasReservation = reservations.some(r => 
                            r.date === currentDate && 
                            r.staffId == staffId && 
                            !r.paid && 
                            r.startTime
                        );
                        
                        if (hasReservation) {
                            item.style.backgroundColor = '#9ca3af';
                            item.style.color = 'white';
                        } else if (isOnVacation) {
                            item.style.backgroundColor = '#ef4444';
                            item.style.color = 'white';
                        } else {
                            item.style.backgroundColor = '#3b82f6';
                            item.style.color = 'white';
                        }
                    }
                }
            });
            
            selectedStaff = {id, name};
            element.classList.add('selected');
            // 선택된 직원은 초록색으로 변경
            element.style.backgroundColor = '#10b981';
            element.style.color = 'white';
        }

        function selectMenu(id, name, element) {
            // 이전 선택 해제
            document.querySelectorAll('#menuSelection .selection-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            selectedMenu = {id, name};
            element.classList.add('selected');
            selectedDuration = null;
            
            loadDurationSelection();
            updateReservationDetails();
        }

        function selectDuration(duration, element) {
            // 이전 선택 해제
            document.querySelectorAll('#durationSelection .selection-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            selectedDuration = duration;
            element.classList.add('selected');
            updateReservationDetails();
        }

        function updateReservationDetails() {
            if (selectedMenu && selectedDuration) {
                const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
                const menu = menus.find(m => m.id === selectedMenu.id);
                
                if (menu && menu.prices && menu.prices[selectedDuration]) {
                    const priceData = menu.prices[selectedDuration];
                    document.getElementById('reservationPrice').textContent = priceData.price.toLocaleString();
                    document.getElementById('reservationCommission').textContent = priceData.commission.toLocaleString();
                }
            } else {
                document.getElementById('reservationPrice').textContent = '0';
                document.getElementById('reservationCommission').textContent = '0';
            }
            updateCurrencyDisplay();
        }

        function addReservation() {
            if (!selectedStaff || !selectedMenu || !selectedDuration) {
                alert('마사지사, 메뉴, 시간을 모두 선택해주세요.');
                return;
            }

            const startTime = document.getElementById('reservationStartTime').value;
            const roomId = document.getElementById('reservationRoom').value;
            const customerName = document.getElementById('reservationCustomer').value;

            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');

            const selectedRoom = rooms.find(r => r.id == roomId);
            const menu = menus.find(m => m.id === selectedMenu.id);
            const priceData = menu.prices[selectedDuration];

            const newReservation = {
                id: Date.now(),
                date: document.getElementById('currentDate').value,
                staffId: selectedStaff.id,
                staffName: selectedStaff.name,
                menuId: selectedMenu.id,
                menuName: selectedMenu.name,
                duration: selectedDuration,
                startTime: startTime,
                roomId: roomId,
                roomNumber: selectedRoom ? selectedRoom.roomNumber : '',
                customerName: customerName,
                price: priceData.price,
                commission: priceData.commission,
                paid: false,
                paymentDetails: {}
            };

            reservations.push(newReservation);
            localStorage.setItem(getAdminKey('reservations'), JSON.stringify(reservations));

            alert('예약이 추가되었습니다.');
            
            // 선택 초기화
            selectedStaff = null;
            selectedMenu = null;
            selectedDuration = null;
            
            document.querySelectorAll('.selection-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            document.getElementById('reservationStartTime').value = '';
            document.getElementById('reservationRoom').value = '';
            document.getElementById('reservationCustomer').value = '';
            document.getElementById('reservationPrice').textContent = '0';
            document.getElementById('reservationCommission').textContent = '0';
            document.getElementById('durationSelection').innerHTML = '';
        }

        // 입금 관련 함수
        function showPaymentModal(reservationId) {
            currentPaymentReservationId = reservationId;
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservation = reservations.find(r => r.id === reservationId);
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');

            document.getElementById('paymentTotalAmount').textContent = reservation.price.toLocaleString();
            document.getElementById('paymentCurrency').textContent = currency.symbol;
            document.getElementById('paymentEnteredCurrency').textContent = currency.symbol;
            
            const methodsContainer = document.getElementById('paymentMethods');
            methodsContainer.innerHTML = '';

            paymentMethods.forEach(method => {
                const defaultValue = method.name === '현금' ? reservation.price : 0;
                methodsContainer.innerHTML += `
                    <div class="flex items-center gap-2">
                        <label class="w-20">${method.name}:</label>
                        <input type="number" id="payment_${method.id}" class="border rounded px-2 py-1 flex-1" value="${defaultValue}" onchange="updatePaymentTotal()" inputmode="numeric" pattern="[0-9]*">
                        <span>${currency.symbol}</span>
                    </div>
                `;
            });

            document.getElementById('paymentModal').style.display = 'block';
            updatePaymentTotal();
        }

        function updatePaymentTotal() {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            let total = 0;

            paymentMethods.forEach(method => {
                const input = document.getElementById(`payment_${method.id}`);
                if (input) {
                    total += parseInt(input.value) || 0;
                }
            });

            document.getElementById('paymentEnteredAmount').textContent = total.toLocaleString();
        }

        function processPayment() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const reservation = reservations.find(r => r.id === currentPaymentReservationId);
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const enteredAmount = parseInt(document.getElementById('paymentEnteredAmount').textContent.replace(/,/g, ''));

            // QR팁 금액 계산
            let qrTipAmount = 0;
            paymentMethods.forEach(method => {
                if (method.name === 'QR팁') {
                    const input = document.getElementById(`payment_${method.id}`);
                    if (input) {
                        qrTipAmount += parseInt(input.value) || 0;
                    }
                }
            });

            // QR팁을 제외한 금액이 예약 가격과 일치하는지 확인
            const amountExcludingTip = enteredAmount - qrTipAmount;
            if (amountExcludingTip !== reservation.price) {
                alert('QR팁을 제외한 입력된 금액이 총 금액과 일치하지 않습니다.');
                return;
            }

            // 입금 방식별 상세 정보 저장
            const paymentDetails = {};
            paymentMethods.forEach(method => {
                const input = document.getElementById(`payment_${method.id}`);
                if (input && parseInt(input.value) > 0) {
                    paymentDetails[method.name] = parseInt(input.value);
                }
            });

            reservation.paid = true;
            reservation.paymentDetails = paymentDetails;
            localStorage.setItem(getAdminKey('reservations'), JSON.stringify(reservations));

            alert('입금이 완료되었습니다.');
            closePaymentModal();
            loadDashboard();
        }

        function closePaymentModal() {
            document.getElementById('paymentModal').style.display = 'none';
            currentPaymentReservationId = null;
        }

        // 통계 관련 함수
        function showDailyStats() {
            document.getElementById('chartContainer').style.display = 'none';
            const date = document.getElementById('statsDate').value;
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const dailyReservations = reservations.filter(r => r.date === date && r.paid);
            
            displayStats(dailyReservations);
        }

        function showWeeklyStats() {
            document.getElementById('chartContainer').style.display = 'none';
            const date = new Date(document.getElementById('statsDate').value);
            const startOfWeek = new Date(date);
            startOfWeek.setDate(date.getDate() - date.getDay());
            
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);

            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const weeklyReservations = reservations.filter(r => {
                const reservationDate = new Date(r.date);
                return reservationDate >= startOfWeek && reservationDate <= endOfWeek && r.paid;
            });

            displayStats(weeklyReservations);
        }

        function showMonthlyStats() {
            document.getElementById('chartContainer').style.display = 'none';
            const date = new Date(document.getElementById('statsDate').value);
            const year = date.getFullYear();
            const month = date.getMonth();

            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const monthlyReservations = reservations.filter(r => {
                const reservationDate = new Date(r.date);
                return reservationDate.getFullYear() === year && reservationDate.getMonth() === month && r.paid;
            });

            displayStats(monthlyReservations);
        }

        function displayStats(reservations) {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const statsTable = document.getElementById('statsTable');
            const paymentStatsTable = document.getElementById('paymentStatsTable');
            const staffStats = {};
            const paymentStats = {};

            reservations.forEach(reservation => {
                // 직원별 통계
                if (!staffStats[reservation.staffName]) {
                    staffStats[reservation.staffName] = {
                        totalPrice: 0,
                        totalCommission: 0
                    };
                }
                staffStats[reservation.staffName].totalPrice += reservation.price;
                staffStats[reservation.staffName].totalCommission += reservation.commission;

                // 입금방식별 통계
                if (reservation.paymentDetails) {
                    Object.keys(reservation.paymentDetails).forEach(method => {
                        if (!paymentStats[method]) {
                            paymentStats[method] = 0;
                        }
                        paymentStats[method] += reservation.paymentDetails[method];
                    });
                }
            });

            // 직원별 통계 표시
            statsTable.innerHTML = '';
            let grandTotalPrice = 0;
            let grandTotalCommission = 0;

            Object.keys(staffStats).forEach(staffName => {
                const stats = staffStats[staffName];
                grandTotalPrice += stats.totalPrice;
                grandTotalCommission += stats.totalCommission;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${staffName}</td>
                    <td class="border border-gray-300 p-2">${stats.totalPrice.toLocaleString()}${currency.symbol}</td>
                    <td class="border border-gray-300 p-2">${stats.totalCommission.toLocaleString()}${currency.symbol}</td>
                `;
                statsTable.appendChild(row);
            });

            // 입금방식별 통계 표시 (QR팁 제외한 총액 계산)
            paymentStatsTable.innerHTML = '';
            let qrTipTotal = 0;
            Object.keys(paymentStats).forEach(method => {
                if (method === 'QR팁') {
                    qrTipTotal += paymentStats[method];
                }
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${method}</td>
                    <td class="border border-gray-300 p-2">${paymentStats[method].toLocaleString()}${currency.symbol}</td>
                `;
                paymentStatsTable.appendChild(row);
            });

            const totalProfit = grandTotalPrice - grandTotalCommission;
            
            document.getElementById('grandTotalPrice').textContent = grandTotalPrice.toLocaleString();
            document.getElementById('grandTotalCommission').textContent = grandTotalCommission.toLocaleString();
            document.getElementById('totalProfit').textContent = totalProfit.toLocaleString();
            document.getElementById('grandTotalCurrency').textContent = currency.symbol;
            document.getElementById('grandTotalCommissionCurrency').textContent = currency.symbol;
            document.getElementById('totalProfitCurrency').textContent = currency.symbol;
        }

        function updateStats() {
            showDailyStats();
        }

        // DB 관리 함수들
        function manageMenus() {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            let content = `
                <div class="mb-4">
                    <button onclick="showAddMenuForm()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600" data-translate="add">새 메뉴 추가</button>
                </div>
                <div id="addMenuForm" style="display: none;" class="mb-4 p-4 bg-gray-50 rounded border">
                    <h4 class="font-bold mb-2">새 메뉴 추가</h4>
                    <div class="grid grid-cols-6 gap-2 mb-2">
                        <input type="text" id="newMenuName" placeholder="메뉴명" class="border rounded px-2 py-1">
                        <div>
                            <input type="number" id="newMenuPrice30" placeholder="30분 가격" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm30" placeholder="30분 커미션" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div>
                            <input type="number" id="newMenuPrice60" placeholder="60분 가격" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm60" placeholder="60분 커미션" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div>
                            <input type="number" id="newMenuPrice90" placeholder="90분 가격" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm90" placeholder="90분 커미션" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div>
                            <input type="number" id="newMenuPrice120" placeholder="120분 가격" class="border rounded px-1 py-1 w-full mb-1">
                            <input type="number" id="newMenuComm120" placeholder="120분 커미션" class="border rounded px-1 py-1 w-full">
                        </div>
                        <div class="flex flex-col gap-1">
                            <button onclick="saveNewMenu()" class="bg-green-500 text-white px-2 py-1 rounded text-sm">추가</button>
                            <button onclick="hideAddMenuForm()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                        </div>
                    </div>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">메뉴명</th>
                            <th class="border border-gray-300 p-2">30분</th>
                            <th class="border border-gray-300 p-2">60분</th>
                            <th class="border border-gray-300 p-2">90분</th>
                            <th class="border border-gray-300 p-2">120분</th>
                            <th class="border border-gray-300 p-2">작업</th>
                        </tr>
                    </thead>
                    <tbody id="menuTableBody">
            `;

            menus.forEach(menu => {
                content += `
                    <tr id="menuRow_${menu.id}">
                        <td class="border border-gray-300 p-2">${menu.name}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[30] ? menu.prices[30].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[30].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[60] ? menu.prices[60].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[60].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[90] ? menu.prices[90].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[90].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">${menu.prices[120] ? menu.prices[120].price.toLocaleString() + currency.symbol + ' / ' + menu.prices[120].commission.toLocaleString() + currency.symbol : '-'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editMenu(${menu.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="copyMenu(${menu.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">복사</button>
                            <button onclick="deleteMenu(${menu.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].menuManagement || '메뉴 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
            updateTranslations();
        }

        function showAddMenuForm() {
            document.getElementById('addMenuForm').style.display = 'block';
        }

        function hideAddMenuForm() {
            document.getElementById('addMenuForm').style.display = 'none';
            clearMenuForm();
        }

        function clearMenuForm() {
            document.getElementById('newMenuName').value = '';
            ['30', '60', '90', '120'].forEach(duration => {
                document.getElementById(`newMenuPrice${duration}`).value = '';
                document.getElementById(`newMenuComm${duration}`).value = '';
            });
        }

        function saveNewMenu() {
            const name = document.getElementById('newMenuName').value;
            if (!name) {
                alert('메뉴명을 입력해주세요.');
                return;
            }

            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const newMenu = {
                id: Date.now(),
                name: name,
                prices: {}
            };

            [30, 60, 90, 120].forEach(duration => {
                const price = document.getElementById(`newMenuPrice${duration}`).value;
                const commission = document.getElementById(`newMenuComm${duration}`).value;
                
                if (price && commission && !isNaN(price) && !isNaN(commission) && parseInt(price) > 0) {
                    newMenu.prices[duration] = {
                        price: parseInt(price),
                        commission: parseInt(commission)
                    };
                }
            });

            menus.push(newMenu);
            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            alert('새 메뉴가 추가되었습니다.');
            manageMenus();
        }

        function copyMenu(id) {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === id);
            if (!menu) return;

            const newMenu = {
                id: Date.now(),
                name: menu.name + ' (복사)',
                prices: JSON.parse(JSON.stringify(menu.prices))
            };

            menus.push(newMenu);
            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            alert('메뉴가 복사되었습니다.');
            manageMenus();
        }

        function editMenu(id) {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === id);
            if (!menu) return;

            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            const row = document.getElementById(`menuRow_${id}`);
            
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editName_${id}" value="${menu.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice30_${id}" value="${menu.prices[30] ? menu.prices[30].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm30_${id}" value="${menu.prices[30] ? menu.prices[30].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice60_${id}" value="${menu.prices[60] ? menu.prices[60].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm60_${id}" value="${menu.prices[60] ? menu.prices[60].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice90_${id}" value="${menu.prices[90] ? menu.prices[90].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm90_${id}" value="${menu.prices[90] ? menu.prices[90].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editPrice120_${id}" value="${menu.prices[120] ? menu.prices[120].price : ''}" placeholder="가격" class="w-full border rounded px-1 py-1 mb-1">
                    <input type="number" id="editComm120_${id}" value="${menu.prices[120] ? menu.prices[120].commission : ''}" placeholder="커미션" class="w-full border rounded px-1 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveMenu(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageMenus()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveMenu(id) {
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const menu = menus.find(m => m.id === id);
            if (!menu) return;

            menu.name = document.getElementById(`editName_${id}`).value;
            menu.prices = {};

            [30, 60, 90, 120].forEach(duration => {
                const price = document.getElementById(`editPrice${duration}_${id}`).value;
                const commission = document.getElementById(`editComm${duration}_${id}`).value;
                
                if (price && commission && !isNaN(price) && !isNaN(commission) && parseInt(price) > 0) {
                    menu.prices[duration] = {
                        price: parseInt(price),
                        commission: parseInt(commission)
                    };
                }
            });

            localStorage.setItem(getAdminKey('menus'), JSON.stringify(menus));
            manageMenus();
        }

        function deleteMenu(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
                const filteredMenus = menus.filter(m => m.id !== id);
                localStorage.setItem(getAdminKey('menus'), JSON.stringify(filteredMenus));
                manageMenus();
            }
        }

        function manageStaff() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="showAddStaffForm()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 직원 추가</button>
                </div>
                <div id="addStaffForm" style="display: none;" class="mb-4 p-4 bg-gray-50 rounded border">
                    <h4 class="font-bold mb-2">새 직원 추가</h4>
                    <div class="grid grid-cols-6 gap-2 mb-2">
                        <input type="text" id="newStaffName" placeholder="이름" class="border rounded px-2 py-1">
                        <input type="text" id="newStaffPhone" placeholder="전화번호" class="border rounded px-2 py-1">
                        <input type="text" id="newStaffBank" placeholder="은행명" class="border rounded px-2 py-1">
                        <input type="text" id="newStaffAccount" placeholder="계좌번호" class="border rounded px-2 py-1">
                        <select id="newStaffStatus" class="border rounded px-2 py-1">
                            <option value="정직원">정직원</option>
                            <option value="단기고용">단기고용</option>
                            <option value="퇴사">퇴사</option>
                        </select>
                        <div class="flex flex-col gap-1">
                            <button onclick="saveNewStaff()" class="bg-green-500 text-white px-2 py-1 rounded text-sm">추가</button>
                            <button onclick="hideAddStaffForm()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                        </div>
                    </div>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2" data-translate="staffName">이름</th>
                            <th class="border border-gray-300 p-2" data-translate="phoneNumber">전화번호</th>
                            <th class="border border-gray-300 p-2" data-translate="bankName">은행명</th>
                            <th class="border border-gray-300 p-2" data-translate="accountNumber">계좌번호</th>
                            <th class="border border-gray-300 p-2" data-translate="status">상태</th>
                            <th class="border border-gray-300 p-2" data-translate="actions">작업</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            staff.forEach(s => {
                content += `
                    <tr id="staffRow_${s.id}">
                        <td class="border border-gray-300 p-2">${s.name}</td>
                        <td class="border border-gray-300 p-2">${s.phone}</td>
                        <td class="border border-gray-300 p-2">${s.bank}</td>
                        <td class="border border-gray-300 p-2">${s.account}</td>
                        <td class="border border-gray-300 p-2">${s.status || '정직원'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editStaff(${s.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="copyStaff(${s.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">복사</button>
                            <button onclick="deleteStaff(${s.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = translations[currentLanguage].staffManagement || '직원 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
            updateTranslations();
        }

        function showAddStaffForm() {
            document.getElementById('addStaffForm').style.display = 'block';
        }

        function hideAddStaffForm() {
            document.getElementById('addStaffForm').style.display = 'none';
            clearStaffForm();
        }

        function clearStaffForm() {
            document.getElementById('newStaffName').value = '';
            document.getElementById('newStaffPhone').value = '';
            document.getElementById('newStaffBank').value = '';
            document.getElementById('newStaffAccount').value = '';
            document.getElementById('newStaffStatus').value = '정직원';
        }

        function saveNewStaff() {
            const name = document.getElementById('newStaffName').value;
            const phone = document.getElementById('newStaffPhone').value;
            
            if (!name || !phone) {
                alert('이름과 전화번호는 필수입니다.');
                return;
            }

            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const newStaff = {
                id: Date.now(),
                name: name,
                phone: phone,
                bank: document.getElementById('newStaffBank').value || '',
                account: document.getElementById('newStaffAccount').value || '',
                status: document.getElementById('newStaffStatus').value
            };
            staff.push(newStaff);
            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            alert('새 직원이 추가되었습니다.');
            manageStaff();
        }

        function copyStaff(id) {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const member = staff.find(s => s.id === id);
            if (!member) return;

            const newStaff = {
                id: Date.now(),
                name: member.name + ' (복사)',
                phone: member.phone,
                bank: member.bank,
                account: member.account
            };

            staff.push(newStaff);
            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            alert('직원이 복사되었습니다.');
            manageStaff();
        }

        function editStaff(id) {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const member = staff.find(s => s.id === id);
            if (!member) return;

            const row = document.getElementById(`staffRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffName_${id}" value="${member.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffPhone_${id}" value="${member.phone}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffBank_${id}" value="${member.bank}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editStaffAccount_${id}" value="${member.account}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <select id="editStaffStatus_${id}" class="w-full border rounded px-2 py-1">
                        <option value="정직원" ${(member.status || '정직원') === '정직원' ? 'selected' : ''}>정직원</option>
                        <option value="단기고용" ${member.status === '단기고용' ? 'selected' : ''}>단기고용</option>
                        <option value="퇴사" ${member.status === '퇴사' ? 'selected' : ''}>퇴사</option>
                    </select>
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveStaff(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageStaff()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveStaff(id) {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const member = staff.find(s => s.id === id);
            if (!member) return;

            member.name = document.getElementById(`editStaffName_${id}`).value;
            member.phone = document.getElementById(`editStaffPhone_${id}`).value;
            member.bank = document.getElementById(`editStaffBank_${id}`).value;
            member.account = document.getElementById(`editStaffAccount_${id}`).value;
            member.status = document.getElementById(`editStaffStatus_${id}`).value;

            localStorage.setItem(getAdminKey('staff'), JSON.stringify(staff));
            manageStaff();
        }

        function deleteStaff(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
                const filteredStaff = staff.filter(s => s.id !== id);
                localStorage.setItem(getAdminKey('staff'), JSON.stringify(filteredStaff));
                manageStaff();
            }
        }

        function manageCurrency() {
            const currency = JSON.parse(localStorage.getItem(getAdminKey('currency')) || '{"symbol":"","name":"원"}');
            
            let content = `
                <div class="mb-4">
                    <h4 class="text-lg font-bold mb-2">화폐 단위 설정</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">화폐 기호:</label>
                            <select id="currencySymbol" class="w-full border rounded px-3 py-2">
                                <option value="" ${currency.symbol === '' ? 'selected' : ''}>없음 (숫자만)</option>
                                <option value="₩" ${currency.symbol === '₩' ? 'selected' : ''}>₩ (원)</option>
                                <option value="$" ${currency.symbol === '$' ? 'selected' : ''}>$ (달러)</option>
                                <option value="€" ${currency.symbol === '€' ? 'selected' : ''}>€ (유로)</option>
                                <option value="¥" ${currency.symbol === '¥' ? 'selected' : ''}>¥ (엔)</option>
                                <option value="£" ${currency.symbol === '£' ? 'selected' : ''}>£ (파운드)</option>
                                <option value="฿" ${currency.symbol === '฿' ? 'selected' : ''}>฿ (바트)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">화폐 이름:</label>
                            <input type="text" id="currencyName" value="${currency.name}" class="w-full border rounded px-3 py-2">
                        </div>
                    </div>
                    <button onclick="saveCurrency()" class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">저장</button>
                </div>
            `;

            document.getElementById('managementTitle').textContent = '화폐 단위 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function saveCurrency() {
            const symbol = document.getElementById('currencySymbol').value;
            const name = document.getElementById('currencyName').value;
            
            const currency = { symbol, name };
            localStorage.setItem(getAdminKey('currency'), JSON.stringify(currency));
            
            alert('화폐 단위가 저장되었습니다.');
            updateCurrencyDisplay();
            closeManagementModal();
        }

        // 기타 관리 함수들 (간단 구현)
        function manageRooms() {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewRoom()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 방 추가</button>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">방번호</th>
                            <th class="border border-gray-300 p-2">수용인원</th>
                            <th class="border border-gray-300 p-2">작업</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            rooms.forEach(room => {
                content += `
                    <tr id="roomRow_${room.id}">
                        <td class="border border-gray-300 p-2">${room.roomNumber}</td>
                        <td class="border border-gray-300 p-2">${room.capacity}명</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editRoom(${room.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="copyRoom(${room.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">복사</button>
                            <button onclick="deleteRoom(${room.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = '방 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }
        
        function manageCustomers() {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewCustomer()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 고객 추가</button>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">고객명</th>
                            <th class="border border-gray-300 p-2">전화번호</th>
                            <th class="border border-gray-300 p-2">고객번호</th>
                            <th class="border border-gray-300 p-2">작업</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            customers.forEach(customer => {
                content += `
                    <tr id="customerRow_${customer.id}">
                        <td class="border border-gray-300 p-2">${customer.name}</td>
                        <td class="border border-gray-300 p-2">${customer.phone}</td>
                        <td class="border border-gray-300 p-2">${customer.customerNumber}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editCustomer(${customer.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="copyCustomer(${customer.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">복사</button>
                            <button onclick="deleteCustomer(${customer.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = '고객 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }
        
        function managePaymentMethods() {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="addNewPaymentMethod()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 입금방식 추가</button>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">입금방식명</th>
                            <th class="border border-gray-300 p-2">작업</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            paymentMethods.forEach(method => {
                content += `
                    <tr id="paymentMethodRow_${method.id}">
                        <td class="border border-gray-300 p-2">${method.name}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editPaymentMethod(${method.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="copyPaymentMethod(${method.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">복사</button>
                            <button onclick="deletePaymentMethod(${method.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = '입금방식 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }
        
        function manageAdmins() {
            if (currentAdmin.type !== 'super') {
                alert('최고관리자만 접근 가능합니다.');
                return;
            }
            
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            let content = `
                <div class="mb-4">
                    <button onclick="showAddAdminForm()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">새 관리자 추가</button>
                </div>
                <div id="addAdminForm" style="display: none;" class="mb-4 p-4 bg-gray-50 rounded border">
                    <h4 class="font-bold mb-2">새 관리자 추가</h4>
                    <div class="grid grid-cols-5 gap-2 mb-2">
                        <input type="text" id="newAdminUsername" placeholder="아이디" class="border rounded px-2 py-1">
                        <input type="password" id="newAdminPassword" placeholder="비밀번호" class="border rounded px-2 py-1">
                        <input type="text" id="newAdminShopName" placeholder="가게명" class="border rounded px-2 py-1">
                        <input type="text" id="newAdminPhone" placeholder="전화번호" class="border rounded px-2 py-1">
                        <div class="flex flex-col gap-1">
                            <button onclick="saveNewAdmin()" class="bg-green-500 text-white px-2 py-1 rounded text-sm">추가</button>
                            <button onclick="hideAddAdminForm()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                        </div>
                    </div>
                </div>
                <table class="w-full border-collapse border border-gray-300">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2">아이디</th>
                            <th class="border border-gray-300 p-2">타입</th>
                            <th class="border border-gray-300 p-2">가게명</th>
                            <th class="border border-gray-300 p-2">전화번호</th>
                            <th class="border border-gray-300 p-2">작업</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            admins.forEach(admin => {
                content += `
                    <tr id="adminRow_${admin.id}">
                        <td class="border border-gray-300 p-2">${admin.username}</td>
                        <td class="border border-gray-300 p-2">${admin.type === 'super' ? '최고관리자' : '일반관리자'}</td>
                        <td class="border border-gray-300 p-2">${admin.shopName || '-'}</td>
                        <td class="border border-gray-300 p-2">${admin.phone || '-'}</td>
                        <td class="border border-gray-300 p-2">
                            <button onclick="editAdmin(${admin.id})" class="bg-blue-500 text-white px-2 py-1 rounded text-sm mr-1">수정</button>
                            <button onclick="changeAdminPassword(${admin.id})" class="bg-purple-500 text-white px-2 py-1 rounded text-sm mr-1">비밀번호</button>
                            <button onclick="copyAdmin(${admin.id})" class="bg-yellow-500 text-white px-2 py-1 rounded text-sm mr-1">복사</button>
                            ${admin.type !== 'super' ? `<button onclick="deleteAdmin(${admin.id})" class="bg-red-500 text-white px-2 py-1 rounded text-sm">삭제</button>` : ''}
                        </td>
                    </tr>
                `;
            });

            content += '</tbody></table>';

            document.getElementById('managementTitle').textContent = '관리자 관리';
            document.getElementById('managementContent').innerHTML = content;
            document.getElementById('managementModal').style.display = 'block';
        }

        function deleteReservation(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
                const filteredReservations = reservations.filter(r => r.id !== id);
                localStorage.setItem(getAdminKey('reservations'), JSON.stringify(filteredReservations));
                loadDashboard();
            }
        }

        function editReservation(id) { 
            alert('예약 수정 기능은 추후 구현 예정입니다.'); 
        }

        // 방 관리 함수들
        function addNewRoom() {
            const roomNumber = prompt('방번호를 입력하세요:');
            if (!roomNumber) return;
            
            const capacity = prompt('수용인원을 입력하세요:');
            if (!capacity || isNaN(capacity) || parseInt(capacity) <= 0) {
                alert('올바른 수용인원을 입력해주세요.');
                return;
            }

            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const newRoom = {
                id: Date.now(),
                roomNumber: roomNumber,
                capacity: parseInt(capacity)
            };
            rooms.push(newRoom);
            localStorage.setItem(getAdminKey('rooms'), JSON.stringify(rooms));
            alert('새 방이 추가되었습니다.');
            manageRooms();
        }

        function editRoom(id) {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const room = rooms.find(r => r.id === id);
            if (!room) return;

            const row = document.getElementById(`roomRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editRoomNumber_${id}" value="${room.roomNumber}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="number" id="editRoomCapacity_${id}" value="${room.capacity}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveRoom(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageRooms()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveRoom(id) {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const room = rooms.find(r => r.id === id);
            if (!room) return;

            room.roomNumber = document.getElementById(`editRoomNumber_${id}`).value;
            room.capacity = parseInt(document.getElementById(`editRoomCapacity_${id}`).value);

            localStorage.setItem(getAdminKey('rooms'), JSON.stringify(rooms));
            manageRooms();
        }

        function deleteRoom(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
                const filteredRooms = rooms.filter(r => r.id !== id);
                localStorage.setItem(getAdminKey('rooms'), JSON.stringify(filteredRooms));
                manageRooms();
            }
        }

        // 고객 관리 함수들
        function addNewCustomer() {
            const name = prompt('고객명을 입력하세요:');
            if (!name) return;
            
            const phone = prompt('전화번호를 입력하세요:');
            if (!phone) return;
            
            const customerNumber = prompt('고객번호를 입력하세요:');
            if (!customerNumber) return;

            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            
            // 중복 고객번호 체크
            if (customers.find(c => c.customerNumber === customerNumber)) {
                alert('이미 존재하는 고객번호입니다.');
                return;
            }
            
            const newCustomer = {
                id: Date.now(),
                name: name,
                phone: phone,
                customerNumber: customerNumber
            };
            customers.push(newCustomer);
            localStorage.setItem(getAdminKey('customers'), JSON.stringify(customers));
            alert('새 고객이 추가되었습니다.');
            manageCustomers();
        }

        function editCustomer(id) {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const customer = customers.find(c => c.id === id);
            if (!customer) return;

            const row = document.getElementById(`customerRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editCustomerName_${id}" value="${customer.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editCustomerPhone_${id}" value="${customer.phone}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editCustomerNumber_${id}" value="${customer.customerNumber}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveCustomer(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageCustomers()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveCustomer(id) {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const customer = customers.find(c => c.id === id);
            if (!customer) return;

            customer.name = document.getElementById(`editCustomerName_${id}`).value;
            customer.phone = document.getElementById(`editCustomerPhone_${id}`).value;
            customer.customerNumber = document.getElementById(`editCustomerNumber_${id}`).value;

            localStorage.setItem(getAdminKey('customers'), JSON.stringify(customers));
            manageCustomers();
        }

        function deleteCustomer(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
                const filteredCustomers = customers.filter(c => c.id !== id);
                localStorage.setItem(getAdminKey('customers'), JSON.stringify(filteredCustomers));
                manageCustomers();
            }
        }

        // 입금방식 관리 함수들
        function addNewPaymentMethod() {
            const name = prompt('입금방식명을 입력하세요:');
            if (!name) return;

            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            
            // 중복 입금방식 체크
            if (paymentMethods.find(m => m.name === name)) {
                alert('이미 존재하는 입금방식입니다.');
                return;
            }
            
            const newMethod = {
                id: Date.now(),
                name: name
            };
            paymentMethods.push(newMethod);
            localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(paymentMethods));
            alert('새 입금방식이 추가되었습니다.');
            managePaymentMethods();
        }

        function editPaymentMethod(id) {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const method = paymentMethods.find(m => m.id === id);
            if (!method) return;

            const row = document.getElementById(`paymentMethodRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editPaymentMethodName_${id}" value="${method.name}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="savePaymentMethod(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="managePaymentMethods()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function savePaymentMethod(id) {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const method = paymentMethods.find(m => m.id === id);
            if (!method) return;

            method.name = document.getElementById(`editPaymentMethodName_${id}`).value;

            localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(paymentMethods));
            managePaymentMethods();
        }

        function deletePaymentMethod(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
                const filteredMethods = paymentMethods.filter(m => m.id !== id);
                localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(filteredMethods));
                managePaymentMethods();
            }
        }

        // 관리자 관리 함수들
        function addNewAdmin() {
            const username = prompt('아이디를 입력하세요:');
            if (!username) return;
            
            const password = prompt('비밀번호를 입력하세요:');
            if (!password) return;
            
            const shopName = prompt('가게명을 입력하세요:');
            const phone = prompt('전화번호를 입력하세요:');

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            
            // 중복 아이디 체크
            if (admins.find(a => a.username === username)) {
                alert('이미 존재하는 아이디입니다.');
                return;
            }

            const newAdmin = {
                id: Date.now(),
                username: username,
                password: password,
                type: 'normal',
                shopName: shopName || '',
                phone: phone || ''
            };
            admins.push(newAdmin);
            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            alert('새 관리자가 추가되었습니다.');
            manageAdmins();
        }

        function editAdmin(id) {
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.id === id);
            if (!admin) return;

            const row = document.getElementById(`adminRow_${id}`);
            row.className = 'edit-row';
            row.innerHTML = `
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editAdminUsername_${id}" value="${admin.username}" class="w-full border rounded px-2 py-1" ${admin.type === 'super' ? 'readonly' : ''}>
                </td>
                <td class="border border-gray-300 p-2">
                    <select id="editAdminType_${id}" class="w-full border rounded px-2 py-1" ${admin.type === 'super' ? 'disabled' : ''}>
                        <option value="normal" ${admin.type === 'normal' ? 'selected' : ''}>일반관리자</option>
                        <option value="super" ${admin.type === 'super' ? 'selected' : ''}>최고관리자</option>
                    </select>
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editAdminShopName_${id}" value="${admin.shopName || ''}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <input type="text" id="editAdminPhone_${id}" value="${admin.phone || ''}" class="w-full border rounded px-2 py-1">
                </td>
                <td class="border border-gray-300 p-2">
                    <button onclick="saveAdmin(${id})" class="bg-green-500 text-white px-2 py-1 rounded text-sm mr-1">저장</button>
                    <button onclick="manageAdmins()" class="bg-gray-500 text-white px-2 py-1 rounded text-sm">취소</button>
                </td>
            `;
        }

        function saveAdmin(id) {
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.id === id);
            if (!admin) return;

            if (admin.type !== 'super') {
                admin.username = document.getElementById(`editAdminUsername_${id}`).value;
                admin.type = document.getElementById(`editAdminType_${id}`).value;
            }
            admin.shopName = document.getElementById(`editAdminShopName_${id}`).value;
            admin.phone = document.getElementById(`editAdminPhone_${id}`).value;

            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            manageAdmins();
        }

        function deleteAdmin(id) {
            if (confirm('정말 삭제하시겠습니까?')) {
                const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
                const filteredAdmins = admins.filter(a => a.id !== id);
                localStorage.setItem('globalAdmins', JSON.stringify(filteredAdmins));
                manageAdmins();
            }
        }

        function closeManagementModal() {
            document.getElementById('managementModal').style.display = 'none';
        }

        function showLanguageModal() {
            document.getElementById('languageModal').style.display = 'block';
        }

        function closeLanguageModal() {
            document.getElementById('languageModal').style.display = 'none';
        }

        function setLanguageAndClose(lang) {
            setLanguage(lang);
            closeLanguageModal();
        }

        // 데이터 백업 및 복원 함수들
        let currentGoogleAction = null;

        function showLocalBackupDialog() {
            if (window.showDirectoryPicker) {
                // 최신 브라우저에서 폴더 선택 지원
                window.showDirectoryPicker().then(directoryHandle => {
                    backupDataLocal(directoryHandle);
                }).catch(err => {
                    if (err.name !== 'AbortError') {
                        // 폴더 선택이 지원되지 않는 경우 기본 다운로드
                        backupDataLocal();
                    }
                });
            } else {
                // 폴더 선택이 지원되지 않는 경우 기본 다운로드
                backupDataLocal();
            }
        }

        function showLocalRestoreDialog() {
            if (window.showDirectoryPicker) {
                // 최신 브라우저에서 폴더 선택 지원
                window.showDirectoryPicker().then(directoryHandle => {
                    // 폴더에서 JSON 파일 찾기
                    showFileSelectionFromDirectory(directoryHandle);
                }).catch(err => {
                    if (err.name !== 'AbortError') {
                        // 폴더 선택이 지원되지 않는 경우 파일 선택
                        document.getElementById('restoreFile').click();
                    }
                });
            } else {
                // 폴더 선택이 지원되지 않는 경우 파일 선택
                document.getElementById('restoreFile').click();
            }
        }

        function showGoogleBackupDialog() {
            currentGoogleAction = 'backup';
            document.getElementById('googleLoginModal').style.display = 'block';
        }

        function showGoogleRestoreDialog() {
            currentGoogleAction = 'restore';
            document.getElementById('googleLoginModal').style.display = 'block';
        }

        function closeGoogleLoginModal() {
            document.getElementById('googleLoginModal').style.display = 'none';
            document.getElementById('googleEmail').value = '';
            document.getElementById('googlePassword').value = '';
            currentGoogleAction = null;
        }

        function processGoogleLogin() {
            const email = document.getElementById('googleEmail').value;
            const password = document.getElementById('googlePassword').value;
            
            if (!email || !password) {
                alert('이메일과 비밀번호를 모두 입력해주세요.');
                return;
            }

            // 실제 구글 API 연동은 보안상 제한되므로 시뮬레이션
            alert('보안상의 이유로 실제 구글 계정 연동은 제한됩니다. 로컬 백업/복원을 사용해주세요.');
            closeGoogleLoginModal();
            
            if (currentGoogleAction === 'backup') {
                backupDataLocal();
            } else if (currentGoogleAction === 'restore') {
                document.getElementById('restoreFile').click();
            }
        }

        async function showFileSelectionFromDirectory(directoryHandle) {
            try {
                const files = [];
                for await (const [name, handle] of directoryHandle.entries()) {
                    if (handle.kind === 'file' && name.endsWith('.json')) {
                        files.push({name, handle});
                    }
                }
                
                if (files.length === 0) {
                    alert('선택한 폴더에 JSON 백업 파일이 없습니다.');
                    return;
                }
                
                // 파일 선택 다이얼로그 표시
                let fileList = '복원할 파일을 선택하세요:\n\n';
                files.forEach((file, index) => {
                    fileList += `${index + 1}. ${file.name}\n`;
                });
                
                const selection = prompt(fileList + '\n번호를 입력하세요:');
                const fileIndex = parseInt(selection) - 1;
                
                if (fileIndex >= 0 && fileIndex < files.length) {
                    const fileHandle = files[fileIndex].handle;
                    const file = await fileHandle.getFile();
                    const text = await file.text();
                    
                    try {
                        const data = JSON.parse(text);
                        if (confirm('기존 데이터를 덮어쓰시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                            Object.keys(data).forEach(key => {
                                localStorage.setItem(key, data[key]);
                            });
                            alert('데이터가 복원되었습니다. 페이지를 새로고침합니다.');
                            location.reload();
                        }
                    } catch (error) {
                        alert('잘못된 백업 파일입니다.');
                    }
                }
            } catch (error) {
                alert('폴더에서 파일을 읽는 중 오류가 발생했습니다.');
            }
        }

        async function backupDataLocal(directoryHandle = null) {
            const adminData = {};
            const keys = Object.keys(localStorage);
            
            keys.forEach(key => {
                if (key.startsWith(currentAdmin.username + '_')) {
                    adminData[key] = localStorage.getItem(key);
                }
            });

            const dataStr = JSON.stringify(adminData, null, 2);
            const fileName = `${currentAdmin.username}_backup_${new Date().toISOString().split('T')[0]}.json`;
            
            if (directoryHandle) {
                try {
                    const fileHandle = await directoryHandle.getFileHandle(fileName, { create: true });
                    const writable = await fileHandle.createWritable();
                    await writable.write(dataStr);
                    await writable.close();
                    alert('선택한 폴더에 백업이 완료되었습니다.');
                } catch (error) {
                    // 폴더 저장 실패시 기본 다운로드
                    downloadBackupFile(dataStr, fileName);
                }
            } else {
                downloadBackupFile(dataStr, fileName);
            }
        }

        function downloadBackupFile(dataStr, fileName) {
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            link.click();
            
            URL.revokeObjectURL(url);
            alert('백업 파일이 다운로드되었습니다.');
        }

        function restoreData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('기존 데이터를 덮어쓰시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                        Object.keys(data).forEach(key => {
                            localStorage.setItem(key, data[key]);
                        });
                        alert('데이터가 복원되었습니다. 페이지를 새로고침합니다.');
                        location.reload();
                    }
                } catch (error) {
                    alert('잘못된 백업 파일입니다.');
                }
            };
            reader.readAsText(file);
        }

        function exportAllDataExcel() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const menus = JSON.parse(localStorage.getItem(getAdminKey('menus')) || '[]');
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            
            let csvContent = "구분,날짜,직원명,메뉴,시간,가격,커미션,방번호,고객명,입금완료\n";
            
            // 예약 데이터
            reservations.forEach(reservation => {
                csvContent += `예약,${reservation.date},${reservation.staffName},${reservation.menuName},${reservation.duration}분,${reservation.price},${reservation.commission},${reservation.roomNumber || ''},${reservation.customerName || ''},${reservation.paid ? '완료' : '미완료'}\n`;
            });
            
            // 직원 데이터
            csvContent += "\n직원 정보\n";
            csvContent += "이름,전화번호,은행명,계좌번호,상태\n";
            staff.forEach(member => {
                csvContent += `${member.name},${member.phone},${member.bank},${member.account},${member.status || '정직원'}\n`;
            });
            
            // 메뉴 데이터
            csvContent += "\n메뉴 정보\n";
            csvContent += "메뉴명,30분가격,30분커미션,60분가격,60분커미션,90분가격,90분커미션,120분가격,120분커미션\n";
            menus.forEach(menu => {
                const p30 = menu.prices[30] || {price: '', commission: ''};
                const p60 = menu.prices[60] || {price: '', commission: ''};
                const p90 = menu.prices[90] || {price: '', commission: ''};
                const p120 = menu.prices[120] || {price: '', commission: ''};
                csvContent += `${menu.name},${p30.price},${p30.commission},${p60.price},${p60.commission},${p90.price},${p90.commission},${p120.price},${p120.commission}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `전체데이터_${currentAdmin.username}_${new Date().toISOString().split('T')[0]}.csv`);
            link.click();
            URL.revokeObjectURL(url);
            alert('전체 데이터 엑셀 파일이 다운로드되었습니다.');
        }

        // 관리자 관리 새 함수들
        function showAddAdminForm() {
            document.getElementById('addAdminForm').style.display = 'block';
        }

        function hideAddAdminForm() {
            document.getElementById('addAdminForm').style.display = 'none';
            clearAdminForm();
        }

        function clearAdminForm() {
            document.getElementById('newAdminUsername').value = '';
            document.getElementById('newAdminPassword').value = '';
            document.getElementById('newAdminShopName').value = '';
            document.getElementById('newAdminPhone').value = '';
        }

        function saveNewAdmin() {
            const username = document.getElementById('newAdminUsername').value;
            const password = document.getElementById('newAdminPassword').value;
            
            if (!username || !password) {
                alert('아이디와 비밀번호는 필수입니다.');
                return;
            }

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            
            if (admins.find(a => a.username === username)) {
                alert('이미 존재하는 아이디입니다.');
                return;
            }

            const newAdmin = {
                id: Date.now(),
                username: username,
                password: password,
                type: 'normal',
                shopName: document.getElementById('newAdminShopName').value || '',
                phone: document.getElementById('newAdminPhone').value || ''
            };
            admins.push(newAdmin);
            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            alert('새 관리자가 추가되었습니다.');
            manageAdmins();
        }

        function changeAdminPassword(id) {
            const newPassword = prompt('새 비밀번호를 입력하세요:');
            if (!newPassword) return;

            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.id === id);
            if (admin) {
                admin.password = newPassword;
                localStorage.setItem('globalAdmins', JSON.stringify(admins));
                alert('비밀번호가 변경되었습니다.');
            }
        }

        function copyAdmin(id) {
            const admins = JSON.parse(localStorage.getItem('globalAdmins') || '[]');
            const admin = admins.find(a => a.id === id);
            if (!admin) return;

            const newAdmin = {
                id: Date.now(),
                username: admin.username + '_copy',
                password: admin.password,
                type: 'normal',
                shopName: admin.shopName,
                phone: admin.phone
            };

            admins.push(newAdmin);
            localStorage.setItem('globalAdmins', JSON.stringify(admins));
            alert('관리자가 복사되었습니다.');
            manageAdmins();
        }

        // 차트 및 통계 함수들
        function showMenuChart() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const date = document.getElementById('statsDate').value;
            const dailyReservations = reservations.filter(r => r.date === date && r.paid);
            
            const menuStats = {};
            dailyReservations.forEach(reservation => {
                if (!menuStats[reservation.menuName]) {
                    menuStats[reservation.menuName] = 0;
                }
                menuStats[reservation.menuName] += reservation.price;
            });

            drawChart(Object.keys(menuStats), Object.values(menuStats), '메뉴별 판매 금액', 'bar');
        }

        function showMonthlyChart() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const date = new Date(document.getElementById('statsDate').value);
            const year = date.getFullYear();
            const month = date.getMonth();

            const dailyStats = {};
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                dailyStats[dateStr] = 0;
            }

            reservations.forEach(reservation => {
                const reservationDate = new Date(reservation.date);
                if (reservationDate.getFullYear() === year && reservationDate.getMonth() === month && reservation.paid) {
                    dailyStats[reservation.date] += reservation.price;
                }
            });

            const labels = Object.keys(dailyStats).map(date => date.split('-')[2] + '일');
            const data = Object.values(dailyStats);
            
            drawChart(labels, data, '일별 총 판매 금액', 'bar');
        }

        function drawChart(labels, data, title, type) {
            document.getElementById('chartContainer').style.display = 'block';
            const canvas = document.getElementById('statsChart');
            const ctx = canvas.getContext('2d');
            
            // 캔버스 초기화
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            const padding = 60;
            const chartWidth = canvas.width - padding * 2;
            const chartHeight = canvas.height - padding * 2;
            
            const maxValue = Math.max(...data);
            const barWidth = chartWidth / labels.length * 0.8;
            const barSpacing = chartWidth / labels.length * 0.2;
            
            // 제목
            ctx.fillStyle = '#333';
            ctx.font = '16px Arial';
            ctx.textAlign = 'center';
            ctx.fillText(title, canvas.width / 2, 30);
            
            // 막대 그래프 그리기
            data.forEach((value, index) => {
                const barHeight = (value / maxValue) * chartHeight;
                const x = padding + index * (barWidth + barSpacing);
                const y = canvas.height - padding - barHeight;
                
                // 막대
                ctx.fillStyle = `hsl(${index * 360 / data.length}, 70%, 50%)`;
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // 값 표시
                ctx.fillStyle = '#333';
                ctx.font = '12px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(value.toLocaleString(), x + barWidth / 2, y - 5);
                
                // 라벨
                ctx.save();
                ctx.translate(x + barWidth / 2, canvas.height - padding + 15);
                ctx.rotate(-Math.PI / 4);
                ctx.textAlign = 'right';
                ctx.fillText(labels[index], 0, 0);
                ctx.restore();
            });
            
            // Y축
            ctx.strokeStyle = '#333';
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, canvas.height - padding);
            ctx.stroke();
            
            // X축
            ctx.beginPath();
            ctx.moveTo(padding, canvas.height - padding);
            ctx.lineTo(canvas.width - padding, canvas.height - padding);
            ctx.stroke();
        }

        function downloadExcel() {
            const reservations = JSON.parse(localStorage.getItem(getAdminKey('reservations')) || '[]');
            const currentDate = document.getElementById('statsDate').value;
            const filteredReservations = reservations.filter(r => r.date === currentDate && r.paid);
            
            let csvContent = "날짜,직원명,메뉴,시간,가격,커미션,방번호,고객명\n";
            
            filteredReservations.forEach(reservation => {
                csvContent += `${reservation.date},${reservation.staffName},${reservation.menuName},${reservation.duration}분,${reservation.price},${reservation.commission},${reservation.roomNumber || ''},${reservation.customerName || ''}\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `통계_${currentDate}.csv`);
            link.click();
            URL.revokeObjectURL(url);
        }

        // 나머지 관리 함수들에 복사 기능 추가
        function copyRoom(id) {
            const rooms = JSON.parse(localStorage.getItem(getAdminKey('rooms')) || '[]');
            const room = rooms.find(r => r.id === id);
            if (!room) return;

            const newRoom = {
                id: Date.now(),
                roomNumber: room.roomNumber + '_복사',
                capacity: room.capacity
            };

            rooms.push(newRoom);
            localStorage.setItem(getAdminKey('rooms'), JSON.stringify(rooms));
            alert('방이 복사되었습니다.');
            manageRooms();
        }

        function copyCustomer(id) {
            const customers = JSON.parse(localStorage.getItem(getAdminKey('customers')) || '[]');
            const customer = customers.find(c => c.id === id);
            if (!customer) return;

            const newCustomer = {
                id: Date.now(),
                name: customer.name + ' (복사)',
                phone: customer.phone,
                customerNumber: customer.customerNumber + '_copy'
            };

            customers.push(newCustomer);
            localStorage.setItem(getAdminKey('customers'), JSON.stringify(customers));
            alert('고객이 복사되었습니다.');
            manageCustomers();
        }

        function copyPaymentMethod(id) {
            const paymentMethods = JSON.parse(localStorage.getItem(getAdminKey('paymentMethods')) || '[]');
            const method = paymentMethods.find(m => m.id === id);
            if (!method) return;

            const newMethod = {
                id: Date.now(),
                name: method.name + ' (복사)'
            };

            paymentMethods.push(newMethod);
            localStorage.setItem(getAdminKey('paymentMethods'), JSON.stringify(paymentMethods));
            alert('입금방식이 복사되었습니다.');
            managePaymentMethods();
        }

        function loadStaffOrder() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const staffOrder = JSON.parse(localStorage.getItem(getAdminKey('staffOrder')) || '{}');
            
            // 정직원과 단기고용 직원만 필터링 (상태가 없는 경우 정직원으로 간주)
            const activeStaff = staff.filter(s => {
                const status = s.status || '정직원';
                return status === '정직원' || status === '단기고용';
            });
            
            const tableBody = document.getElementById('orderTable');
            tableBody.innerHTML = '';

            activeStaff.forEach(member => {
                const currentOrder = staffOrder[member.id] || 1;
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="border border-gray-300 p-2">${member.name}</td>
                    <td class="border border-gray-300 p-2">${member.status || '정직원'}</td>
                    <td class="border border-gray-300 p-2">
                        <select id="order_${member.id}" class="w-full border rounded px-2 py-1">
                            ${generateOrderOptions(currentOrder)}
                        </select>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function generateOrderOptions(selectedOrder) {
            let options = '';
            for (let i = 0; i <= 99; i++) {
                const selected = i === selectedOrder ? 'selected' : '';
                const label = i === 0 ? `${i} (휴가)` : i;
                options += `<option value="${i}" ${selected}>${label}</option>`;
            }
            return options;
        }

        function saveStaffOrder() {
            const staff = JSON.parse(localStorage.getItem(getAdminKey('staff')) || '[]');
            const activeStaff = staff.filter(s => {
                const status = s.status || '정직원';
                return status === '정직원' || status === '단기고용';
            });
            const staffOrder = {};

            activeStaff.forEach(member => {
                const orderSelect = document.getElementById(`order_${member.id}`);
                if (orderSelect) {
                    staffOrder[member.id] = parseInt(orderSelect.value);
                }
            });

            localStorage.setItem(getAdminKey('staffOrder'), JSON.stringify(staffOrder));
            alert('순번이 저장되었습니다.');
            loadReservationData(); // 예약 화면 업데이트
            loadStaffOrder(); // 순번 화면 새로고침
        }

        // 앱 초기화
        initializeApp();
        updateTranslations();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'98e8a2e856a445c5',t:'MTc2MDQ2MTI2Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
